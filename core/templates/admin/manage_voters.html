{% extends 'admin_base.html' %}

{% block admin_content %}
<div class="container mx-auto p-6">
  <h2 class="text-2xl font-semibold mb-6">Manage Voters</h2>

  <table class="min-w-full bg-white border border-gray-300 rounded shadow">
    <thead>
      <tr class="bg-gray-100 text-left">
        <th class="py-2 px-4 border-b">First Name</th>
        <th class="py-2 px-4 border-b">Last Name</th>
        <th class="py-2 px-4 border-b">Email</th>
        <th class="py-2 px-4 border-b">Phone</th>
        <th class="py-2 px-4 border-b">National ID</th>
        <th class="py-2 px-4 border-b">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for voter in voters %}
      <tr class="hover:bg-gray-50">
        <td class="py-2 px-4 border-b">{{ voter.first_name }}</td>
        <td class="py-2 px-4 border-b">{{ voter.last_name }}</td>
        <td class="py-2 px-4 border-b">{{ voter.email }}</td>
        <td class="py-2 px-4 border-b">{{ voter.phone }}</td>
        <td class="py-2 px-4 border-b">{{ voter.national_id }}</td>
        <td class="py-2 px-4 border-b">
          <button
            class="text-indigo-600 hover:text-indigo-900"
            onclick="openEditModal(
              '{{ voter.id }}',
              '{{ voter.first_name|escapejs }}',
              '{{ voter.last_name|escapejs }}',
              '{{ voter.email|escapejs }}',
              '',  /* password empty */
              '{{ voter.phone|default_if_none:""|escapejs }}',
              '{{ voter.national_id|escapejs }}'
            )"
          >
            Edit
          </button>
          <form method="POST" action="{% url 'delete_voter' voter.id %}" class="inline" onsubmit="return confirm('Are you sure you want to delete this voter?');">
    {% csrf_token %}
    <button type="submit" class="text-red-600 hover:text-red-900">
      Delete
    </button>
  </form>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="6" class="text-center py-4">No voters available.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Edit Modal -->
<div
  id="editModal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
  aria-modal="true"
  role="dialog"
  aria-labelledby="editModalTitle"
>
  <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative">
    <button
      class="absolute top-2 right-2 text-gray-500 hover:text-gray-800"
      onclick="closeEditModal()"
      aria-label="Close modal"
    >
      &times;
    </button>
    <h3 id="editModalTitle" class="text-xl font-semibold mb-4">Edit Voter</h3>
    <form id="editVoterForm" method="POST" action="{% url 'edit_voter' %}" class="space-y-4">
      {% csrf_token %}
      <input type="hidden" name="voter_id" id="voterIdInput" />
      <div>
        <label class="block mb-1 font-medium" for="firstNameInput">First Name</label>
        <input
          type="text"
          name="first_name"
          id="firstNameInput"
          class="w-full border border-gray-300 rounded px-3 py-2"
          required
        />
      </div>
      <div>
        <label class="block mb-1 font-medium" for="lastNameInput">Last Name</label>
        <input
          type="text"
          name="last_name"
          id="lastNameInput"
          class="w-full border border-gray-300 rounded px-3 py-2"
          required
        />
      </div>
      <div>
        <label class="block mb-1 font-medium" for="emailInput">Email</label>
        <input
          type="email"
          name="email"
          id="emailInput"
          class="w-full border border-gray-300 rounded px-3 py-2"
          required
        />
      </div>
      <div>
        <label class="block mb-1 font-medium" for="passwordInput">Password</label>
        <input
          type="password"
          name="password"
          id="passwordInput"
          class="w-full border border-gray-300 rounded px-3 py-2"
          placeholder="Leave blank to keep current"
        />
      </div>
      <div>
        <label class="block mb-1 font-medium" for="phoneInput">Phone</label>
        <input
          type="text"
          name="phone"
          id="phoneInput"
          class="w-full border border-gray-300 rounded px-3 py-2"
        />
      </div>
      <div>
        <label class="block mb-1 font-medium" for="nationalIdInput">National ID</label>
        <input
          type="text"
          name="national_id"
          id="nationalIdInput"
          class="w-full border border-gray-300 rounded px-3 py-2"
          required
        />
      </div>
      <div class="text-right">
        <button
          type="button"
          class="mr-3 px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
          onclick="closeEditModal()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700"
        >
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  function openEditModal(id, firstName, lastName, email, password, phone, nationalId) {
    document.getElementById('voterIdInput').value = id;
    document.getElementById('firstNameInput').value = firstName;
    document.getElementById('lastNameInput').value = lastName;
    document.getElementById('emailInput').value = email;
    document.getElementById('passwordInput').value = ''; // blank password for edit
    document.getElementById('phoneInput').value = phone;
    document.getElementById('nationalIdInput').value = nationalId;

    document.getElementById('editModal').classList.remove('hidden');
  }

  function closeEditModal() {
    document.getElementById('editModal').classList.add('hidden');
  }
</script>
{% endblock %}
